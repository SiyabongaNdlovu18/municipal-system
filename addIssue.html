<!DOCTYPE html>
<html>
<head>
  <title>Submit Issue</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="center-screen">

<!-- addIssue.html (body only) -->
<div class="card glass">
  <h2>Submit Municipal Issue</h2>

  <form id="issueForm" onsubmit="event.preventDefault(); submitIssueFromForm('issueForm')">
    <input class="input" id="name" name="citizen_name" placeholder="Your Full Name" required>
    <input class="input" id="location" name="location" placeholder="Location (click Use Current Location)" required>
    <button type="button" class="btn" onclick="fillCurrentLocation('location')">Use Current Location</button>

    <select class="input" id="issue_type" name="issue_type">
      <option>Water Leakage</option>
      <option>Potholes</option>
      <option>Electricity Issue</option>
      <option>Garbage Collection</option>
      <option>Sewage Problems</option>
      
    </select>

    <textarea class="input" id="description" name="description" placeholder="Describe Issue"></textarea>
    <button class="btn" type="submit">Submit Issue</button>
    <p id="msg"></p>
  </form>
</div>

<script src="script.js"></script>

<script>
async function submitIssue(){
  const payload = {
    citizen_name: document.getElementById("name").value,
    issue_type: document.getElementById("issue_type").value,
    description: document.getElementById("description").value,
    location: document.getElementById("location").value
  };

  const res = await fetch('/addIssue',{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(payload)
  });

  const data = await res.json();
  document.getElementById("msg").innerText = data.message;

  // Clear form
  document.getElementById("name").value = "";
  document.getElementById("description").value = "";
  document.getElementById("location").value = "";
}

// GET CURRENT LOCATION
function getLocation(){
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(position=>{
      const lat = position.coords.latitude;
      const lng = position.coords.longitude;
      document.getElementById("location").value = `${lat}, ${lng}`;
      window.open(`https://www.google.com/maps/search/?api=1&query=${lat},${lng}`, '_blank');
    });
  } else {
    alert("Geolocation not supported!");
    
  }
}
</script>

</body>
</html>
